<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Cartographie</title>
    <meta charset="utf-8" />
    <meta name="author" content="Pascal Burkhard" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="personal.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Cartographie
## avec Python üêç
### Pascal Burkhard
### LDDR 2021-2022

---




# Cartographie

## Introduction

.pull-left-large[La cartographie consiste √† repr√©senter un espace (g√©n√©ralement r√©el) sous une forme graphique simplifi√©e.

Historiquement les plus vieilles cartes dont on garde une trace sont des *p√©troglyphes* comme ceux de Bedolina en Italie (voir ci-contre).

Au cours de la pr√©histoire, les civilsations greco-romaines font de la cartographie une discipline √† part enti√®re. Des savants tels qu'Eratosth√®ne et Ptol√©m√©e perfectionnent les techniques et mettent en place des concepts tels que les *syst√®mes de coordon√©es* ou les *projections*.]

.pull-right-small[
&lt;img src="img/bedolina.jpg" width="1067" /&gt;
]

---

# Cartographie

## Introduction

.pull-left[Au fil des si√®cles, les cartes r√©alis√©es √† l'√©poque de Ptol√©m√©e sont reprises et parfois augment√©es.

Le d√©veloppement de la cartographie est souvent √©troitement li√© avec les volont√©es de conqu√™te et d'exploration. Les progr√®s, notament dans le domaine de la navigation permettent √©galement d'√©tendre les fronti√®res du monde connue et d'am√©liorer les cartes existante.

Au 16e Si√®cle, des cartographes comme *Gerardus Mercator* et *Abraham Ortelius* donne un nouvel √©lan √† la discipline. L'invention d'une projection *conforme* par *Mercator* am√©liore consid√©rablement la navigation. En effet, un cape pr√©cis √©quivaut √† une ligne droite sur ce type de cartes.]

.pull-right[
&lt;img src="img/mercator.png" width="1544" /&gt;
]

---

# Cartographie informatique

## Les *syst√®mes d'information g√©ographique*

.pull-left-large[Avec l'apparition des outils num√©riques, la cartographie vit une nouvelle r√©volution: l'apparition des *syst√®mes d'information g√©ographique* ou *SIG* (*GIS* en anglais). La cartographie devient num√©rique et offre des possibilit√©s de recueil, de traitement et d'analyse qui √©tait jusqu'√† pr√©sent inimaginable.

Diff√©rentes couches de donn√©es peuvent √™tre superpos√©es, analys√©es, voir combin√©es pour obtenir des informations ou des cartes de synth√®se. Ces couches peuvent contenir des donn√©es de nature tr√®s vari√©e (donn√©es satellites, hydrographie, topographie, routes, constructions, zones d'amm√©nagement, informations statistiques, ‚Ä¶).]

.pull-right-small[
&lt;img src="img/gis_layers.jpg" width="803" /&gt;
]

---

# Cartographie informatique

## Types de donn√©es

.pull-left-small[
Les donn√©es num√©rique de cartographie se divise en deux types :

- les donn√©es *vectorielles*
- les donn√©es *raster*

Les donn√©es vecteurs peuvent √™tre subdivis√©e en trois types :

- point
- ligne
- polygone
]

.pull-right-large[
&lt;img src="img/raster_vector.png" width="843" /&gt;
]

---

# Cartographie informatique

## Exercices

Lien vers le portail pour les exercices :

.boldcenter[
[https://geoviews.link/PyCartoProj](https://geoviews.link/PyCartoProj)
]

---

# Cartographie informatique

## Lire des donn√©es raster

Nous aurons besoin des modules suivants :


```python
import matplotlib.pyplot as plt # Pour afficher les donn√©es raster
from matplotlib import cm # Pour la palette de couleur
from osgeo import gdal # Pour lire les donn√©es raster
```

Pour lire des donn√©es raster on aura recours √† la fonction `Open` de `gdal` :


```python
DEM = gdal.Open("geodata/Neuchatel.tif")
DEM_Array = DEM.GetRasterBand(1).ReadAsArray()
DEM_Array.ndim
```

```
## 2
```

DEM_Array est une matrice avec 2 dimensions: un *rectangle* de donn√©es avec les dimensions suivantes:


```python
DEM_Array.shape
```

```
## (213, 251)
```

---

# Cartographie informatique

## Lire des donn√©es raster ‚Äì exercice

Explorez la matrice `DEM_Array`. Vous pouvez acc√©der √† des morceaux de la matrice de la fa√ßon suivant:


```python
DEM_Array[50] # Donne toutes les donn√©es le long de la 51√®me ligne
```

```python
DEM_Array[120,120] # Donne la donn√©es de la 121√®me ligne et de la 121√®me colonne
```

```python
DEM_Array[120,120:130] # Donne les donn√©es de la 121√®me ligne, allant de la 121√®me √† la 130√®me colonne
```

En sachant qu'il s'agit de donn√©es raster du canton de Neuch√¢tel. Quelle donn√©es pourrait-on avoir *encod√©* dans cette matrice ?

--


```python
DEM_Array[50,120:130]
```

```
## array([1193.802, 1199.504, 1177.895, 1160.395, 1131.594, 1109.304,
##        1102.297, 1088.296, 1077.399, 1058.006], dtype=float32)
```

Comme nous le montre ce petit *extrait* de la matrice, il s'agit tr√®s certainement de l'**altitude**.

---

# Cartographie informatique

## Afficher des donn√©es raster ‚Äì exercice

.pull-left[
En quelque lignes on peut se rendre compte de ce que donne cette matrice.


```python
plt.imshow(DEM_Array, cmap=cm.gist_earth) # On affiche la matrice sous forme d'image, cmap = palette de couleur √† utiliser
plt.axis('off') # On d√©sactive les coordon√©es autour de la carte
```

```python
cbar = plt.colorbar(shrink=0.5) # On r√©cup√®re la barre de couleur (en la r√©duisant √† 50% de sa taille originale)
cbar.set_label('m√®tres') # et on rajoute le Label `m√®tres` 

plt.show() # Et on affiche la figure 
```

Essayez !
]

--

.pull-right[
&lt;img src="Presentation_Geo_files/figure-html/neuch-elev-1.png" width="672" /&gt;
]

---

# Cartographie informatique

## Lire des donn√©es vecteur

Nous aurons besoin des modules suivants :


```python
import pandas as pd # pandas permet de manipuler des tableaux de donn√©es
import geopandas as gpd # geopandas `√©tend` panda pour permettre des colonnes `vecteur`
import matplotlib.pyplot as plt # Pour afficher des donn√©es
from matplotlib.colors import TwoSlopeNorm # Pour la palette de couleur
```

Pour lire des donn√©es vecteur on aura recours √† la fonction `read_file` de `geopandas` :


```python
cantons = gpd.read_file('geodata/Cantons.shp')
```

---

# Cartographie informatique

## Lire des donn√©es vecteur ‚Äì exercice

Explorez la tableau de donn√©es `cantons`. Vous pouvez afficher les colonnes de la mani√®re suivantes :


```python
cantons.columns # Affiche le nom de toutes les colonnes du tableau `cantons`
```

```python
cantons['KTNAME'] # Affiche le contenu de la colonne `KTNAME`
```

Quelle colonne contient les informations g√©ographiques ? Comment sont-elles repr√©sent√©es ?

--


```python
cantons['geometry'].head(5)
```

```
## 0    POLYGON ((2692430.313 1281173.385, 2692994.572...
## 1    MULTIPOLYGON (((2573502.159 1194804.872, 25739...
## 2    POLYGON ((2662038.335 1237690.711, 2662272.506...
## 3    POLYGON ((2688457.671 1203339.733, 2688740.672...
## 4    POLYGON ((2705203.471 1229720.915, 2706143.049...
## Name: geometry, dtype: geometry
```

---

# Cartographie informatique

## Lire des donn√©es statistiques ‚Äì exercice

Pandas permet de lire des donn√©es statistiques (sous forme de fichier *csv*, *excel* ou autre tableau de donn√©es) :


```python
pop = pd.read_csv('statdata/swiss_pop_2021.csv')
nat = pd.read_csv('statdata/swiss_nat_2021.csv')
```


En utilisant les m√™mes fonctions que pour le tableau `cantons`, explorer les tableaux `pop` et `nat`. Que contiennent-ils¬†?

--

Les chiffres de la **population** et des **taux de natalit√©** par cantons suisses.

---

# Cartographie informatique

## Combiner des tableaux de donn√©es

*Pandas/GeoPandas* permet de facilement combiner des tableaux de donn√©es lorsqu'on poss√®de une colonne qui identifie de la m√™me mani√®re les donn√©es de deux tableaux diff√©rents.

Le code ci-dessous combine le tableau `cantons` (avec sa colonne *identifiant* `KTNR`) avec le tableau `nat` et sa colonne `ID` :


```python
cantons_nat = cantons.set_index('KTNR').join(nat.set_index('ID'))
cantons_nat.head(3)
```

```
##             KTNAME  GRNR  AREA_HA   X_MIN  ...   Canton  Naissances  Filles  Gar√ßons
## KTNR                                       ...                                      
## 1           Z√ºrich     4   172894  669244  ...   Zurich       17281    8767     8514
## 2     Bern / Berne     2   595952  556241  ...    Berne       10234    5310     4924
## 3           Luzern     6   149352  630127  ...  Lucerne        4451    2243     2208
## 
## [3 rows x 26 columns]
```

La fonction `set_index()` indique la colonne √† utiliser comme *cl√©* d'identification.

---

# Cartographie informatique

## Combiner des tableaux de donn√©es ‚Äì exercice

Trouvez un moyen de combiner le tableau `cantons` avec les donn√©es du tableau `pop` **et** les donn√©es du tableau `nat`.

--

Indice : la colonne `Canton` dans les deux tableaux `pop` et `nat` pose probl√®me lorsqu'on essaye de joindre le deuxi√®me tableau. La fonction `drop(columns = 'NomDeColonne')` permet de retirer une colonne d'un tableau.

--


```python
cantons_pop_nat = cantons.set_index('KTNR').join(pop.set_index('ID')).join(nat.set_index('ID').drop(columns = 'Canton'))
cantons_pop_nat.columns
```

```
## Index(['KTNAME', 'GRNR', 'AREA_HA', 'X_MIN', 'X_MAX', 'Y_MIN', 'Y_MAX',
##        'X_CNTR', 'Y_CNTR', 'Z_MIN', 'Z_MAX', 'Z_AVG', 'Z_MED', 'E_MIN',
##        'E_MAX', 'N_MIN', 'N_MAX', 'E_CNTR', 'N_CNTR', 'Shape_Leng',
##        'Shape_Area', 'geometry', 'Canton', 'Population', 'Naissances',
##        'Filles', 'Gar√ßons'],
##       dtype='object')
```

---

# Cartographie informatique

## Combiner des tableaux de donn√©es ‚Äì exercice

Il est relativement simple de manipuler des tableaux de donn√©es. Si on veut par exemple cr√©er une colonne `TxNat` qui contient le taux de natalit√© (en pour mille), on peut proc√©der de la sorte :


```python
cantons_pop_nat['TxNat'] = cantons_pop_nat['Naissances']/cantons_pop_nat['Population']*1000
cantons_pop_nat['TxNat'].head(3)
```

```
## KTNR
## 1    11.124465
## 2     9.810839
## 3    10.690602
## Name: TxNat, dtype: float64
```

Cr√©ez les colonnes `TxNat` avec le *taux de natalit√©* (comme ci-dessus), ainsi qu'une colonne `RapFG` avec le rapport des sexes (nombre de naissances *gar√ßons* pour 100 naissances *filles*).

---

# Cartographie informatique

## Combiner des tableaux de donn√©es ‚Äì exercice


```python
cantons_pop_nat['RapFG'] = cantons_pop_nat['Gar√ßons']/cantons_pop_nat['Filles']*100
cantons_pop_nat['RapFG'].head(10)
```

```
## KTNR
## 1      97.114178
## 2      92.730697
## 3      98.439590
## 4     103.902439
## 5      94.137931
## 6      89.010989
## 7     106.010929
## 8     106.250000
## 9      90.807799
## 10     95.023573
## Name: RapFG, dtype: float64
```

---

# Cartographie informatique

## Afficher des donn√©es vecteur

.pull-left[
On peut tr√®s facilement afficher la carte d'un tableau de donn√©es g√©ographiques.


```python
cantons_pop_nat.plot()
```
]

.pull-right[
&lt;img src="Presentation_Geo_files/figure-html/map-swiss-no-data-1.png" width="672" /&gt;
]

---

# Cartographie informatique

## Afficher des donn√©es vecteur

.pull-left[
En sp√©cifiant un argument `column='TxNat'` par exemple, on peut afficher les donn√©es d'une colonne sur la carte.


```python
cantons_pop_nat.plot(column='TxNat', legend=True)
```
]

.pull-right[
&lt;img src="Presentation_Geo_files/figure-html/map-swiss-cbr-1.png" width="672" /&gt;
]

---

# Cartographie informatique

## Afficher des donn√©es vecteur ‚Äì exercice

Faites une carte avec le rapport de naissances filles/gar√ßons. Quel probl√®me pouvez-vous constater ?

--

.pull-left[

```python
cantons_pop_nat.plot(column='RapFG', legend=True)
```
]

.pull-right[
&lt;img src="Presentation_Geo_files/figure-html/map-swiss-sxrt-1.png" width="672" /&gt;
]

---

# Cartographie informatique

## Afficher des donn√©es vecteur ‚Äì exercice

--

.pull-left[

```python
vmin, vmax, vcenter = cantons_pop_nat['RapFG'].min(), cantons_pop_nat['RapFG'].max(), 100
norm = TwoSlopeNorm(vmin=vmin, vcenter=vcenter, vmax=vmax)

cmap = 'RdBu'
cbar = plt.cm.ScalarMappable(norm=norm, cmap=cmap)

cantons_pop_nat.plot(column='RapFG', cmap=cmap, legend=False)

plt.colorbar(cbar, orientation = 'horizontal')
```

```python
plt.axis('off')
```

```python
plt.show()
```
]

.pull-right[
&lt;img src="Presentation_Geo_files/figure-html/map-swiss-sxrt-2-1.png" width="672" /&gt;
]

---

# Cartographie informatique

## Projet ‚Äì travaux de groupes

Explorez les donn√©es qui se trouvent dans le dossier *statdata*. √Ä partir de ces donn√©es :

- r√©alisez une carte ‚Äì √©ventuellement en combinant plusieurs indicateurs ;
- analysez la carte que vous obtenez ;
- pr√©parez une br√®ve pr√©sentation de votre carte et de ce qu'elle montre (~5 minutes).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
